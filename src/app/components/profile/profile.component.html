<div class="container">
  <app-sidebar></app-sidebar>
  <div class="content">
    <div class="profile-header">
      <div class="profile-cover"></div>
      <div class="profile-info">
        <div class="profile-picture">
          <img [src]="previewUrl || 'assets/default-avatar.jpg'" alt="Profile Picture">
          <div class="upload-overlay" *ngIf="isEditing">
            <input type="file" id="profilePic" (change)="onFileSelected($event)" accept="image/*" class="file-input">
            <label for="profilePic" class="upload-button">
              <i class="fas fa-camera"></i>
              Change Photo
            </label>
          </div>
        </div>
        <div class="profile-details">
          <h1>{{ profile?.fullName || 'Loading...' }}</h1>
          <p class="role">{{ profile?.role || 'User' }}</p>
          <button class="btn-edit" (click)="toggleEdit()" *ngIf="!isEditing">
            <i class="fas fa-edit"></i> Edit Profile
          </button>
        </div>
      </div>
    </div>

    <div class="profile-content" *ngIf="!isLoading">
      <div class="profile-section">
        <h2>Profile Information</h2>
        <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" *ngIf="isEditing">
          <div class="form-group">
            <label for="userName">Username*</label>
            <input type="text" id="userName" formControlName="userName" class="form-control"
                   [class.invalid]="profileForm.get('userName')?.invalid && profileForm.get('userName')?.touched">
            <div class="error-message" *ngIf="profileForm.get('userName')?.invalid && profileForm.get('userName')?.touched">
              <span *ngIf="profileForm.get('userName')?.errors?.['required']">Username is required</span>
              <span *ngIf="profileForm.get('userName')?.errors?.['minlength']">Username must be at least 3 characters</span>
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email*</label>
            <input type="email" id="email" formControlName="email" class="form-control"
                   [class.invalid]="profileForm.get('email')?.invalid && profileForm.get('email')?.touched">
            <div class="error-message" *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched">
              <span *ngIf="profileForm.get('email')?.errors?.['required']">Email is required</span>
              <span *ngIf="profileForm.get('email')?.errors?.['email']">Please enter a valid email</span>
            </div>
          </div>

          <div class="form-group">
            <label for="fullName">Full Name*</label>
            <input type="text" id="fullName" formControlName="fullName" class="form-control"
                   [class.invalid]="profileForm.get('fullName')?.invalid && profileForm.get('fullName')?.touched">
            <div class="error-message" *ngIf="profileForm.get('fullName')?.invalid && profileForm.get('fullName')?.touched">
              Full name is required
            </div>
          </div>

          <div class="form-group">
            <label for="phoneNumber">Phone Number</label>
            <input type="tel" id="phoneNumber" formControlName="phoneNumber" class="form-control">
          </div>

          <div class="form-group">
            <label for="address">Address*</label>
            <input type="text" id="address" formControlName="address" class="form-control"
                   [class.invalid]="profileForm.get('address')?.invalid && profileForm.get('address')?.touched">
            <div class="error-message" *ngIf="profileForm.get('address')?.invalid && profileForm.get('address')?.touched">
              Address is required
            </div>
          </div>

          <div class="form-group">
            <label for="city">City*</label>
            <input type="text" id="city" formControlName="city" class="form-control"
                   [class.invalid]="profileForm.get('city')?.invalid && profileForm.get('city')?.touched">
            <div class="error-message" *ngIf="profileForm.get('city')?.invalid && profileForm.get('city')?.touched">
              City is required
            </div>
          </div>

          <div class="form-group">
            <label for="bio">Bio</label>
            <textarea id="bio" formControlName="bio" class="form-control" rows="4"></textarea>
          </div>

          <div class="form-actions">
            <button type="submit" [disabled]="!profileForm.valid || isLoading" class="btn-primary">
              Save Changes
            </button>
            <button type="button" (click)="toggleEdit()" class="btn-secondary">
              Cancel
            </button>
          </div>
        </form>

        <div class="profile-info-display" *ngIf="!isEditing">
          <div class="info-row">
            <span class="label">Username:</span>
            <span class="value">{{ profile?.userName }}</span>
          </div>
          <div class="info-row">
            <span class="label">Email:</span>
            <span class="value">{{ profile?.email }}</span>
          </div>
          <div class="info-row">
            <span class="label">Phone:</span>
            <span class="value">{{ profile?.phoneNumber || 'Not provided' }}</span>
          </div>
          <div class="info-row">
            <span class="label">Address:</span>
            <span class="value">{{ profile?.address }}</span>
          </div>
          <div class="info-row">
            <span class="label">City:</span>
            <span class="value">{{ profile?.city }}</span>
          </div>
          <div class="info-row">
            <span class="label">Bio:</span>
            <span class="value">{{ profile?.bio || 'No bio provided' }}</span>
          </div>
        </div>
      </div>

      <div class="profile-section">
        <h2>Social Links</h2>
        <form [formGroup]="socialLinksForm" (ngSubmit)="updateSocialLinks()" *ngIf="isEditing">
          <div class="form-group">
            <label for="facebook">Facebook</label>
            <input type="url" id="facebook" formControlName="facebook" class="form-control" placeholder="Facebook profile URL">
          </div>

          <div class="form-group">
            <label for="instagram">Instagram</label>
            <input type="url" id="instagram" formControlName="instagram" class="form-control" placeholder="Instagram profile URL">
          </div>

          <div class="form-group">
            <label for="twitter">Twitter</label>
            <input type="url" id="twitter" formControlName="twitter" class="form-control" placeholder="Twitter profile URL">
          </div>

          <div class="form-group">
            <label for="soundcloud">SoundCloud</label>
            <input type="url" id="soundcloud" formControlName="soundcloud" class="form-control" placeholder="SoundCloud profile URL">
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary">Update Social Links</button>
          </div>
        </form>

        <div class="social-links" *ngIf="!isEditing">
          <a [href]="profile?.socialLinks?.facebook" target="_blank" class="social-link" *ngIf="profile?.socialLinks?.facebook">
            <i class="fab fa-facebook"></i>
          </a>
          <a [href]="profile?.socialLinks?.instagram" target="_blank" class="social-link" *ngIf="profile?.socialLinks?.instagram">
            <i class="fab fa-instagram"></i>
          </a>
          <a [href]="profile?.socialLinks?.twitter" target="_blank" class="social-link" *ngIf="profile?.socialLinks?.twitter">
            <i class="fab fa-twitter"></i>
          </a>
          <a [href]="profile?.socialLinks?.soundcloud" target="_blank" class="social-link" *ngIf="profile?.socialLinks?.soundcloud">
            <i class="fab fa-soundcloud"></i>
          </a>
        </div>
      </div>
    </div>

    <div class="loading-spinner" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Loading profile...</p>
    </div>
  </div>
</div> 